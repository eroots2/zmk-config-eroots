name: Build ZMK Firmware

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build-left:
    name: Build Left Firmware
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Clone ZMK repository
        run: git submodule update --init --recursive

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y git wget cmake
          pip install west

      - name: Initialize and update Zephyr
        run: |
          west init -l app
          west update
          west zephyr-export

      - name: Build Left Firmware
        run: |
          west build -d build/left -b nice_nano_v2 -- -DSHIELD=eroots_left

      - name: Upload Left Firmware Artifact
        uses: actions/upload-artifact@v3
        with:
          name: left-firmware
          path: build/left/zephyr/eroots_left.uf2

  build-right:
    name: Build Right Firmware
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Clone ZMK repository
        run: git submodule update --init --recursive

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y git wget cmake
          pip install west

      - name: Initialize and update Zephyr
        run: |
          west init -l app
          west update
          west zephyr-export

      - name: Build Right Firmware
        run: |
          west build -d build/right -b nice_nano_v2 -- -DSHIELD=eroots_right

      - name: Upload Right Firmware Artifact
        uses: actions/upload-artifact@v3
        with:
          name: right-firmware
          path: build/right/zephyr/eroots_right.uf2
