#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/bt.h>
// #include <dt-bindings/zmk/trackball_pim447.h> 
#include <dt-bindings/zmk/pointing.h>

#define LY0 0
#define LY1 1
#define LY2 2
#define LY3 3
#define LY4 4
#define LY5 5

#define AS(keycode) &as LS(keycode) keycode


#define COMBO(NAME, BINDINGS, KEYPOS) \
  combo_##NAME { \
    timeout-ms = <50>; \
    bindings = <BINDINGS>; \
    key-positions = <KEYPOS>; \
    layers = <-1>; \
  };

/ {
        combos {
                compatible = "zmk,combos";
                combo_entr {
                    timeout-ms = <30>;
                    key-positions = <39 40>;
                    bindings = <&kp ENTER>;
                };
                combo_bspc {
                    timeout-ms = <30>;
                    key-positions = <41 42>;
                    bindings = <&kp BSPC>;
                };
        };
};

/ {
        behaviors {
            as: auto_shift {
                compatible = "zmk,behavior-hold-tap";
                label = "AUTO_SHIFT";
                #binding-cells = <2>;
                tapping_term_ms = <135>;
                quick_tap_ms = <0>;
                flavor = "tap-preferred";
                bindings = <&kp>, <&kp>;
            };
        };
};
        


/ {
    keymap {
        compatible = "zmk,keymap";

        default_layer {
            display-name = "default";
            bindings = <
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &kp ESC  &kp GRAVE AS(N1)   AS(N2)  AS(N3)   AS(N4)   AS(N5)  AS(N6)            AS(N7)   AS(N8)    AS(N9)    AS(N0)    AS(MINUS) AS(PLUS) AS(BSPC)
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
               &kp LANG2 &kp TAB   AS(Q)   AS(W)    AS(E)   AS(R)    AS(T)              AS(Y)    AS(U)    AS(I)    AS(O)    AS(P)     AS(LBKT) AS(RBKT) AS(BSLH)
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &kp DEL  &kp CAPS  AS(A)   AS(S)    AS(D)   AS(F)    AS(G)                       AS(H)    AS(J)    AS(K)    AS(L)     AS(SEMI)  AS(SQT)  &kp ENTER
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &kp 3    &kp LSHFT AS(Z)   AS(X)   AS(C)    AS(C)    AS(B)                       AS(B)    AS(N)    AS(M)    AS(COMMA) AS(DOT)   AS(FSLH) &kp RSHFT 
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &kp 4    &kp LCTRL &kp LGUI &kp LALT &mo LY2  &lt LY2 SPACE             &lt LY1 SPACE &kp SPACE &lt LY3 SPACE    &kp LEFT  &kp DOWN  &kp UP   &kp RIGHT
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
            >;
        };

        lower_layer {
            display-name = "lower";
            bindings = <
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &trans    &trans    &kp F1   &kp F2   &kp F3   &kp F4   &kp F5   &kp F6              &kp F7   &kp F8    &kp F9    &kp F10   &kp F11   &kp F12  &trans
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &trans    &trans    &trans   &trans    &trans     &trans    &trans               &trans    &trans    &trans     &trans     &trans     &trans     &trans    &trans
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &trans    &trans    &trans   &trans    &trans    &trans    &trans                        &kp LEFT  &kp DOWN   &kp UP   &kp RIGHT     &trans     &trans    &trans  
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &trans    &trans    &trans   &trans    &trans    &trans    &trans                        &trans    &trans     &trans     &trans     &trans     &trans    &trans 
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
                &trans    &trans    &trans   &trans    &trans    &trans                                 &trans    &trans     &trans     &trans     &trans     &trans    &trans 
            // --------------------------------------------------------------------------------------------------------------------------------------------------------
            >;  
        };

        upper_layer {
            display-name = "upper";
            bindings = <
                &studio_unlock  &trans   &trans         &trans         &trans    &trans    &trans    &trans               &trans    &trans     &trans     &trans     &trans     &trans    &trans
                &trans          &trans   &mkp MB1       &mkp MB2       &mkp MB3   &trans    &trans               &trans    &trans    &trans     &trans     &trans     &trans     &trans    &trans
                &trans          &trans   &msc SCRL_UP   &msc SCRL_DOWN  &trans    &trans    &trans                        &trans    &trans     &trans     &trans     &trans     &trans    &trans  
                &trans          &trans   &msc SCRL_LEFT &msc SCRL_RIGHT &trans    &trans    &trans                        &trans    &trans     &trans     &trans     &trans     &trans    &trans 
                &trans          &trans   &trans         &trans          &trans    &trans                                 &trans    &trans     &trans     &trans     &trans     &trans    &trans 
            >;  
        };

        numbr_layer {
            display-name = "numbr";
            bindings = <
                &bt BT_CLR  &none    &bt BT_SEL 0 &bt BT_SEL 1  &bt BT_SEL 2  &none    &none    &none    &none               &none    &none     &none     &none     &none     &none    &none
                &none    &none    &none    &none    &none    &none    &none               &none    &none    &none     &none     &none     &none     &none    &none
                &none    &none    &none    &none    &none    &none    &none                        &none    &none     &none     &none     &none     &none    &none  
                &none    &none    &none    &none    &none    &none    &none                        &none    &none     &none     &none     &none     &none    &none 
                &none    &none    &none    &none    &none    &none                                 &none    &none     &none     &none     &none     &none    &none 
            >;  
        };

        func_layer {
            display-name = "func";
            bindings = <
                &none    &none    &none    &none    &none    &none    &none    &none               &none    &none     &none     &none     &none     &none    &none
                &none    &none    &none    &none    &none    &none    &none               &none    &none    &none     &none     &none     &none     &none    &none
                &none    &none    &none    &none    &none    &none    &none                        &none    &none     &none     &none     &none     &none    &none  
                &none    &none    &none    &none    &none    &none    &none                        &none    &none     &none     &none     &none     &none    &none 
                &none    &none    &none    &none    &none    &none                                 &none    &none     &none     &none     &none     &none    &none 
            >;  
        };

        func1_layer {
            display-name = "func1";
            bindings = <
                &none    &none    &none    &none    &none    &none    &none    &none               &none    &none     &none     &none     &none     &none    &none
                &none    &none    &none    &none    &none    &none    &none               &none    &none    &none     &none     &none     &none     &none    &none
                &none    &none    &none    &none    &none    &none    &none                        &none    &none     &none     &none     &none     &none    &none  
                &none    &none    &none    &none    &none    &none    &none                        &none    &none     &none     &none     &none     &none    &none 
                &none    &none    &none    &none    &none    &none                                 &none    &none     &none     &none     &none     &none    &none 
            >;  
        };
    };
};